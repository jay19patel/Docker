## DOCKER

### Commands :

1. docker run: 
This command is used to create and start a new container from an image.
Example: docker run -it ubuntu bash

2. docker ps: 
This command is used to list all the running containers.

3. docker images: This command is used to list all the available images on the local system.

4. docker build: This command is used to build an image from a Dockerfile.
Example: docker build -t my-image .


5. docker stop: This command is used to stop a running container.
Example: docker stop my-container


6. docker rm: This command is used to remove a stopped container.
Example: docker rm my-container

7. docker rmi: This command is used to remove an image.
Example: docker rmi my-image

8. docker pull: This command is used to download an image from a registry.
Example: docker pull ubuntu

9. docker exec: This command is used to run a command inside a running container.
Example: docker exec my-container ls


10. docker network: This command is used to manage Docker networks.
Example: docker network create my-network


11. docker logs: This command is used to view the logs of a container.
Example: docker logs my-container


12. docker-compose: This command is used to manage multi-container Docker applications.
Example: docker-compose up -d

### docker-compose.yml :

**version**
- This option specifies the version of the docker-compose file format to use.
- Example: version: "3"
- Explanation: This specifies that the docker-compose file uses version 3 of the file format.

**services**
- This option defines the containers that make up your application.
- Example :

```yml
    services:
    web:
        image: nginx
```

**volumes**
- This option defines volumes that can be shared between containers.
- Example :

```yml
volumes:
  my-data:
    driver: local
    driver_opts:
      type: "none"
      device: "C:\\data"
      o: "bind"
# Explanation: This defines a volume called my-data that is stored on the local file system at C:\data.
```

**networks**
- This option defines networks that can be used to connect containers.
- Example :

```yml
networks:
  my-network:
    driver: bridge
# This defines a network called my-network that uses the bridge driver..
```


**ports**
- This option maps ports from the container to the host machine.
- Example :

```yml
services:
  web:
    image: nginx
    ports:
      - "8080:80"

# This maps port 80 in the web container to port 8080 on the host machine.
# Nginx work bydefault in 80 but we map this port to 8080
```

**environment**
- This option sets environment variables that are passed to the container.
- Example :

```yml
services:
  web:
    image: nginx
    environment:
      - MY_VAR=value

# This sets an environment variable called MY_VAR with the value value in the web container.
```

**depends_on**
-  This option defines the order in which containers are started.
- Example :

```yml
services:
  web:
    image: nginx
  db:
    image: mysql
    depends_on:
      - web

# This defines a container called db that runs the mysql image and depends on the web containe.
```


**build**
-  This option specifies the build context for a service, which is used to build a Docker image..
- Example :

```yml
services:
  web:
    build:
      context: .
      dockerfile: Dockerfile


# This builds an image for the web service using the Dockerfile in the current directory as the build context.
```

**restart**
-  This option defines the restart policy for a container.
- Example :

```yml
services:
  web:
    image: nginx
    restart: always

# This sets the web container to always restart if it fails or is stopped.
```

**command**
-   This option overrides the default command for a container.
- Example :

```yml
services:
  web:
    image: nginx
    command: nginx -g 'daemon off;'


# This runs the nginx command with the arguments -g 'daemon off;' instead of the default command for the nginx image..
```
**container_name**
-   This option specifies the name of the container.
- Example :

```yml
services:
  web:
    image: nginx
    container_name: my-nginx

# This sets the name of the container to my-nginx instead of the default name generated by Docker.
```

**image**
-   This option specifies the name and tag of the image used for the service.
- Example :

```yml
services:
  web:
    image: nginx:latest

#  This sets the web service to use the latest nginx image available on Docker Hub.
```
**expose**
-   This option exposes ports on the container without mapping them to the host machine.
- Example :

```yml
services:
  web:
    image: nginx
    expose:
      - "80"


#  This sets the web service to use the latest nginx image available on Docker Hub.
```

## Exmple  FLASK - MONGODB - NGINX
```yml
version: '3'

services:
  web:
    build: .
    ports:
      - "5000:5000"
    environment:
      MONGO_URI: mongodb://mongo:27017/mydatabase
    depends_on:
      - mongo
    networks:
      - webnet

  mongo:
    image: mongo
    volumes:
      - ./mongo_data:/data/db
    networks:
      - webnet

  nginx:
    image: nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./static:/var/www/html
    depends_on:
      - web
    networks:
      - webnet

networks:
  webnet:


```
## File stucture 
```python
myapp/
├── app/
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   └── templates/
│       └── index.html
├── Dockerfile
├── requirements.txt
├── docker-compose.yml
└── nginx.conf
```

## Dockerfile

```Dockerfile
FROM python:3.9-slim-buster

WORKDIR /app

COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt

COPY app app

ENV FLASK_APP=app
ENV FLASK_ENV=production

EXPOSE 5000

CMD ["flask", "run", "--host=0.0.0.0"]



```

## Nginx.conf

```conf
worker_processes 1;

events { worker_connections 1024; }

http {
  upstream myapp {
    server web:5000;
  }

  server {
    listen 80;

    location / {
      proxy_pass http://myapp;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
}


```
